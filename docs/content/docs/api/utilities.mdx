---
title: Utilities
description: Helper functions and testing utilities
---

Helper functions and utilities for testing and development.

## Seed Management

Control randomness for reproducible results.

### SeedManager

Global seed management for deterministic generation.

```typescript
class SeedManager {
  static setSeed(context: string, seed: number): void;
  static random(context?: string): number;
  static setTestSeed(seed?: number): void;
  static clearAll(): void;
}
```

### Usage

```typescript
import { SeedManager } from '@jamesaphoenix/persona-sdk';

// Set global test seed
SeedManager.setTestSeed(12345);

// Set context-specific seeds
SeedManager.setSeed('age-distribution', 100);
SeedManager.setSeed('name-generation', 200);

// Get random values
const random1 = SeedManager.random('age-distribution');
const random2 = SeedManager.random('age-distribution');
// Same seed + context = same sequence

// Clear all seeds
SeedManager.clearAll();
```

### DeterministicRandom

Seeded random number generator using Linear Congruential Generator.

```typescript
class DeterministicRandom {
  constructor(seed: number);
  
  next(): number;              // 0-1
  nextInt(max: number): number; // 0 to max-1
  shuffle<T>(array: T[]): T[];  // Shuffle array
  choice<T>(array: T[]): T;     // Random element
}
```

## Mock Implementations

Testing utilities for development without API calls.

### createMockModule

Create a mock module for testing optimization.

```typescript
function createMockModule(
  qaPairs: Record<string, string>
): MockModule;
```

### Example

```typescript
const mockModule = createMockModule({
  'What is 2+2?': '4',
  'What is the capital of France?': 'Paris',
  'default': 'I don\'t know'
});

const prediction = await mockModule.predict('What is 2+2?');
console.log(prediction.output); // '4'
```

### createMockLanguageModel

Create a mock language model for testing.

```typescript
function createMockLanguageModel(
  responses?: Record<string, string>,
  defaultResponse?: string,
  name?: string
): MockLanguageModel;
```

### Example

```typescript
const mockLLM = createMockLanguageModel(
  {
    'sentiment': 'positive',
    'category': 'technology'
  },
  'unknown',
  'mock-gpt'
);

// Use in tests
const optimizer = new BootstrapOptimizer({
  teacherModel: mockLLM
});
```

### createTestDataset

Generate test datasets for optimization.

```typescript
function createTestDataset(
  size: number,
  type: 'simple' | 'math' | 'reasoning' | 'persona'
): Example[];
```

### Example

```typescript
// Simple classification dataset
const simpleData = createTestDataset(20, 'simple');
// [
//   { input: 'happy', output: 'positive' },
//   { input: 'sad', output: 'negative' },
//   ...
// ]

// Math problems
const mathData = createTestDataset(10, 'math');
// [
//   { input: 'What is 5 + 3?', output: '8' },
//   ...
// ]

// Persona classification
const personaData = createTestDataset(30, 'persona');
// [
//   { 
//     input: { age: 25, occupation: 'Student' },
//     output: 'young-professional'
//   },
//   ...
// ]
```

## Performance Measurement

Track performance of operations.

### measureOptimizationPerformance

Measure time taken by async operations.

```typescript
async function measureOptimizationPerformance<T>(
  operation: () => Promise<T>,
  name: string
): Promise<{
  result: T;
  timeMs: number;
}>;
```

### Example

```typescript
const { result, timeMs } = await measureOptimizationPerformance(
  () => optimizer.optimize(module, trainData),
  'Bootstrap Optimization'
);

console.log(`Optimization took ${timeMs}ms`);
console.log(`Final score: ${result.finalScore}`);
```

## Validation Utilities

Schema validation helpers.

### validatePersonaAttributes

Validate persona attributes against schema.

```typescript
function validatePersonaAttributes(
  attributes: any
): attributes is PersonaAttributes;
```

### validateDistributionConfig

Validate distribution configuration.

```typescript
function validateDistributionConfig(
  config: any
): config is DistributionConfig;
```

### Example

```typescript
const attributes = {
  age: 30,
  occupation: 'Developer',
  sex: 'other',
  experience: 5
};

if (validatePersonaAttributes(attributes)) {
  const persona = new Persona('Test User', attributes);
} else {
  console.error('Invalid attributes');
}
```

## Statistical Utilities

Helper functions for statistical calculations.

### calculateStatistics

Calculate statistics for numeric arrays.

```typescript
function calculateStatistics(values: number[]): {
  mean: number;
  median: number;
  min: number;
  max: number;
  stdDev: number;
  variance: number;
  sum: number;
  count: number;
};
```

### calculatePercentiles

Calculate percentile values.

```typescript
function calculatePercentiles(
  values: number[],
  percentiles: number[]
): number[];
```

### Example

```typescript
const ages = group.personas.map(p => p.attributes.age);

const stats = calculateStatistics(ages);
console.log(`Average age: ${stats.mean.toFixed(1)}`);

const percentiles = calculatePercentiles(ages, [25, 50, 75, 90]);
console.log(`90th percentile age: ${percentiles[3]}`);
```

## Name Generation

Utilities for generating realistic names.

### generateName

Generate random realistic names.

```typescript
function generateName(options?: {
  sex?: Sex;
  origin?: string;
  seed?: number;
}): string;
```

### Example

```typescript
// Random name
const name1 = generateName();

// Sex-specific
const maleName = generateName({ sex: 'male' });
const femaleName = generateName({ sex: 'female' });

// Deterministic
const seededName = generateName({ seed: 12345 });
```

## Data Export

Export personas to various formats.

### exportToCSV

Export personas to CSV format.

```typescript
function exportToCSV(
  personas: Persona[],
  attributes?: string[]
): string;
```

### exportToJSON

Export with proper formatting.

```typescript
function exportToJSON(
  data: PersonaGroup | Persona[],
  pretty?: boolean
): string;
```

### Example

```typescript
// Export to CSV
const csv = exportToCSV(group.personas, ['name', 'age', 'occupation']);
fs.writeFileSync('personas.csv', csv);

// Export to JSON
const json = exportToJSON(group, true);
fs.writeFileSync('personas.json', json);
```

## Batch Processing

Handle large-scale operations efficiently.

### batchProcess

Process items in batches to avoid memory issues.

```typescript
async function batchProcess<T, R>(
  items: T[],
  processor: (batch: T[]) => Promise<R[]>,
  batchSize: number = 100
): Promise<R[]>;
```

### Example

```typescript
// Generate 10,000 personas in batches
const configs = Array(10000).fill(null).map((_, i) => ({
  name: `User ${i}`,
  age: Math.floor(Math.random() * 50) + 20
}));

const personas = await batchProcess(
  configs,
  async (batch) => {
    return batch.map(config => 
      PersonaBuilder.create()
        .withName(config.name)
        .withAge(config.age)
        .withOccupation('User')
        .withSex('other')
        .build()
    );
  },
  500 // Process 500 at a time
);
```

## Type Conversion

Convert between different formats.

### distributionToConfig

Convert Distribution instance to config.

```typescript
function distributionToConfig(
  distribution: Distribution<any>
): DistributionConfig;
```

### configToDistribution

Convert config to Distribution instance.

```typescript
function configToDistribution(
  config: DistributionConfig
): Distribution<any>;
```

### Example

```typescript
// Convert instance to config for API
const normalDist = new NormalDistribution(30, 5);
const config = distributionToConfig(normalDist);
// { type: 'normal', mean: 30, stdDev: 5 }

// Convert config to instance
const distribution = configToDistribution({
  type: 'categorical',
  options: [
    { value: 'A', probability: 0.7 },
    { value: 'B', probability: 0.3 }
  ]
});
```

## Environment Helpers

Utilities for environment setup.

### loadEnvConfig

Load environment configuration safely.

```typescript
function loadEnvConfig(): {
  apiKey?: string;
  apiUrl?: string;
  databaseUrl?: string;
  nodeEnv: 'development' | 'production' | 'test';
};
```

### validateEnvironment

Check required environment variables.

```typescript
function validateEnvironment(
  required: string[]
): void; // Throws if missing
```

### Example

```typescript
// Load config with defaults
const config = loadEnvConfig();

// Validate required vars
try {
  validateEnvironment(['OPENAI_API_KEY', 'DATABASE_URL']);
} catch (error) {
  console.error('Missing environment variables:', error.message);
  process.exit(1);
}
```