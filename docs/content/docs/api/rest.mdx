---
title: REST API
description: HTTP API for persona generation and management
---

HTTP API for generating and managing personas with PostgreSQL persistence.

## Getting Started

Start the API server using the SDK:

```typescript
import { createServer, PgDatabaseClient } from '@jamesaphoenix/persona-sdk';

const dbClient = new PgDatabaseClient({
  connectionString: process.env.DATABASE_URL,
});

const server = await createServer({
  databaseClient: dbClient,
  port: 3000,
  cors: true,
  swagger: true,
});

await server.listen({ port: 3000, host: '0.0.0.0' });
```

## Base URL

```
http://localhost:3000
```

## API Documentation

Interactive Swagger documentation available at:
```
http://localhost:3000/docs
```

## Core Endpoints

### Health Check

Check server status.

```http
GET /health
```

**Response:**
```json
{ "status": "ok" }
```

### Statistics

Get database statistics.

```http
GET /stats
```

**Response:**
```json
{
  "personas": 1250,
  "groups": 45,
  "avgPersonasPerGroup": 27.8
}
```

## Persona Management

### Create Persona

Create a new persona.

```http
POST /personas
```

**Request Body:**
```json
{
  "name": "Alice Johnson",
  "age": 28,
  "occupation": "Software Engineer",
  "sex": "female",
  "attributes": {
    "department": "Engineering",
    "skills": ["TypeScript", "React"]
  },
  "metadata": {
    "source": "manual_creation"
  }
}
```

**Response (201):**
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "name": "Alice Johnson",
  "age": 28,
  "occupation": "Software Engineer",
  "sex": "female",
  "attributes": {
    "department": "Engineering",
    "skills": ["TypeScript", "React"]
  },
  "metadata": {
    "source": "manual_creation"
  },
  "created_at": "2024-01-15T10:30:00Z",
  "updated_at": "2024-01-15T10:30:00Z"
}
```

### List Personas

Get paginated list of personas.

```http
GET /personas?page=1&limit=20&name=Alice&age_min=25&age_max=35
```

**Query Parameters:**
- `page` - Page number (default: 1)
- `limit` - Items per page (default: 20, max: 100)
- `name` - Filter by name (partial match)
- `age_min` - Minimum age
- `age_max` - Maximum age
- `occupation` - Filter by occupation
- `order_by` - Sort field (name, age, created_at)
- `order_direction` - Sort direction (asc, desc)

**Response (200):**
```json
{
  "data": [
    {
      "id": "123e4567-e89b-12d3-a456-426614174000",
      "name": "Alice Johnson",
      "age": 28,
      "occupation": "Software Engineer",
      "sex": "female",
      "attributes": {},
      "metadata": {},
      "created_at": "2024-01-15T10:30:00Z",
      "updated_at": "2024-01-15T10:30:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 1,
    "pages": 1
  }
}
```

### Get Persona

Get specific persona by ID.

```http
GET /personas/{id}
```

**Response (200):** Same as create persona response

**Response (404):**
```json
{ "error": "Persona not found" }
```

### Update Persona

Update persona attributes.

```http
PATCH /personas/{id}
```

**Request Body:** Same fields as create, all optional

**Response (200):** Updated persona object

### Delete Persona

Delete a persona.

```http
DELETE /personas/{id}
```

**Response (204):** No content

### Bulk Create Personas

Create multiple personas at once.

```http
POST /personas/bulk
```

**Request Body:**
```json
{
  "personas": [
    {
      "name": "Person 1",
      "age": 25,
      "occupation": "Developer"
    },
    {
      "name": "Person 2", 
      "age": 30,
      "occupation": "Designer"
    }
  ],
  "group_id": "123e4567-e89b-12d3-a456-426614174001"
}
```

**Response (201):** Array of created persona objects

### Get Persona's Groups

Get all groups a persona belongs to.

```http
GET /personas/{id}/groups
```

**Response (200):** Array of group objects

## Group Management

### Create Group

Create a new persona group.

```http
POST /groups
```

**Request Body:**
```json
{
  "name": "Engineering Team",
  "description": "Software developers and engineers",
  "metadata": {
    "department": "Engineering",
    "budget": 50000
  }
}
```

**Response (201):**
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174001",
  "name": "Engineering Team",
  "description": "Software developers and engineers",
  "metadata": {
    "department": "Engineering",
    "budget": 50000
  },
  "created_at": "2024-01-15T10:30:00Z",
  "updated_at": "2024-01-15T10:30:00Z"
}
```

### List Groups

Get paginated list of groups.

```http
GET /groups?page=1&limit=10&name=Engineering
```

**Query Parameters:** Similar to personas list

**Response (200):** Paginated group objects

### Get Group

Get specific group by ID.

```http
GET /groups/{id}
```

**Response (200):** Group object

### Get Group with Members

Get group with all member personas.

```http
GET /groups/{id}/members
```

**Response (200):**
```json
{
  "group_id": "123e4567-e89b-12d3-a456-426614174001",
  "group_name": "Engineering Team",
  "group_description": "Software developers and engineers",
  "personas": [
    {
      "id": "123e4567-e89b-12d3-a456-426614174000",
      "name": "Alice Johnson",
      "age": 28,
      "occupation": "Software Engineer",
      "sex": "female",
      "attributes": {},
      "metadata": {},
      "created_at": "2024-01-15T10:30:00Z",
      "updated_at": "2024-01-15T10:30:00Z"
    }
  ]
}
```

### Update Group

Update group information.

```http
PATCH /groups/{id}
```

**Request Body:** Same fields as create, all optional

**Response (200):** Updated group object

### Delete Group

Delete a group (removes all memberships).

```http
DELETE /groups/{id}
```

**Response (204):** No content

## Group Membership

### Add Persona to Group

Add an existing persona to a group.

```http
POST /memberships
```

**Request Body:**
```json
{
  "persona_id": "123e4567-e89b-12d3-a456-426614174000",
  "group_id": "123e4567-e89b-12d3-a456-426614174001"
}
```

**Response (201):**
```json
{ "success": true }
```

### Remove Persona from Group

Remove persona from a group.

```http
DELETE /memberships
```

**Request Body:** Same as add membership

**Response (200):**
```json
{ "success": true }
```

## Error Handling

All endpoints return standardized error responses:

```json
{
  "error": "Validation error",
  "details": {
    "field": "age",
    "message": "Must be a positive integer"
  }
}
```

**HTTP Status Codes:**
- `400` - Bad Request (validation errors)
- `404` - Not Found
- `409` - Conflict (duplicate entries)
- `500` - Internal Server Error

## Authentication

Currently no authentication required. For production:

```typescript
const server = await createServer({
  databaseClient: dbClient,
  // Add authentication middleware
});

server.addHook('preHandler', async (request, reply) => {
  const token = request.headers.authorization;
  if (!token) {
    reply.code(401).send({ error: 'Authentication required' });
    return;
  }
  // Validate token
});
```

## SDK Integration

Use the TypeScript SDK for type-safe API access:

```typescript
import { PersonaApiProvider, usePersonas, useCreatePersona } from '@jamesaphoenix/persona-sdk';

// React integration
function App() {
  return (
    <PersonaApiProvider config={{ baseUrl: 'http://localhost:3000' }}>
      <PersonaList />
    </PersonaApiProvider>
  );
}

function PersonaList() {
  const { data, loading, error } = usePersonas({ limit: 10 });
  const createPersona = useCreatePersona();

  const handleCreate = async () => {
    await createPersona.mutate({
      name: 'New Person',
      age: 30,
      occupation: 'Developer'
    });
  };

  return (
    <div>
      {data?.data.map(persona => (
        <div key={persona.id}>{persona.name}</div>
      ))}
      <button onClick={handleCreate}>Create Persona</button>
    </div>
  );
}
```

## Examples

### Complete Workflow

```bash
# 1. Create a group
curl -X POST http://localhost:3000/groups \
  -H "Content-Type: application/json" \
  -d '{"name": "Beta Users", "description": "Early adopters"}'

# 2. Create personas
curl -X POST http://localhost:3000/personas/bulk \
  -H "Content-Type: application/json" \
  -d '{
    "personas": [
      {"name": "Alice", "age": 28, "occupation": "Developer"},
      {"name": "Bob", "age": 32, "occupation": "Designer"}
    ],
    "group_id": "your-group-id"
  }'

# 3. Query personas
curl "http://localhost:3000/personas?age_min=25&age_max=35&limit=10"

# 4. Get group with members
curl "http://localhost:3000/groups/your-group-id/members"
```

### Database Setup

Before using the API, set up your PostgreSQL database:

```sql
-- See database-setup.mdx for complete schema
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

CREATE TABLE IF NOT EXISTS personas (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(255) NOT NULL,
    age INTEGER,
    occupation VARCHAR(255),
    sex VARCHAR(50),
    attributes JSONB DEFAULT '{}',
    metadata JSONB DEFAULT '{}',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

For complete database setup instructions, see the [Database Setup guide](/docs/database-setup).